<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>
</head>
<script src="js/libs/jquery.min.js"></script>
<script>
	var selfCamera;
	function SelfCamera() {};

	(function () {
		var previewLock = false;
	
		SelfCamera.prototype = {
			countdownTimeoutID: -1,
			img: document.createElement('canvas'),
			filename: '',
			video: null,
			src: null,
			isMediaWorking: false
		};
	
		SelfCamera.prototype.onCaptureVideoSuccess = function onCaptureVideoSuccess(stream) {
			var urlStream;
			urlStream = window.webkitURL.createObjectURL(stream);
			this.isMediaWorking = true;
			this.createVideoElement(urlStream);
		};
	
		SelfCamera.prototype.createVideoElement = function (src) {
			this.video = $('<video/>', {
				autoplay: 'autoplay',
				id: 'video',
				style: 'height:' + $(window).height() + 'px',
				src: src
			}).appendTo("#camera").get(0);
	
			this.bindVideoEvents();
		};
	
		SelfCamera.prototype.onCaptureVideoError = function onCaptureVideoError(e) {
			// alert("Video Capture Error");
			console.error(e);
		};
	
		SelfCamera.prototype.startPreview = function startPreview() {
			var options = {
				audio: true,
				video: true
			};
	
			navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;
			try {
				if (typeof (navigator.getUserMedia) === 'function') {
					navigator.getUserMedia(options, this.onCaptureVideoSuccess.bind(this), this.onCaptureVideoError.bind(this));
				}
			} catch (e) {
				alert('navigator.getUserMedia() error.');
				console.error('navigator.getUserMedia() error: ' + e.message);
			}
	
		};
	
		SelfCamera.prototype.captureImage = function captureImage(video) {
			var sourceWidth = window.innerWidth,
				sourceHeight = window.innerHeight,
				sourceX = (sourceWidth - $(video).width()) / 2,
				sourceY = (sourceHeight - $(video).height()) / 2;
	
			this.img.width = sourceWidth;
			this.img.height = sourceHeight;
	
			// Crop image to viewport dimension
			this.img.getContext('2d').drawImage(video, sourceX, sourceY, $(video).width(), $(video).height());
	
			// To get best available dimension
			// this.img.width = video.videoWidth;
			// this.img.height = video.videoHeight;
			// this.img.getContext('2d').drawImage(video, 0, 0);
		};
	
		SelfCamera.prototype.resizeVideo = function() {
			var w = this.video.videoWidth,
				h = this.video.videoHeight,
				W = $(window).width(),
				H = $(window).height(),
				wide = w/h >= W/H,
				margin,
				size;
			if (w <= 0 || h <= 0) {
				setTimeout(this.resizeVideo.bind(this), 100); // wait for stream
				return;
			}
			if (wide) {
				size = Math.round(w * H / h);
				margin = (W - size) / 2,
				$(this.video).css({
					'margin-left': margin + 'px',
					'margin-top':       0 + 'px',
					'width':  size + 'px',
					'height':    H + 'px'
				});
			} else {
				size = Math.round(h * W / w);
				margin = (H - size) / 2,
				$(this.video).css({
					'margin-left':      0 + 'px',
					'margin-top':  margin + 'px',
					'width':     W + 'px',
					'height': size + 'px'
				});
			}
			$('#camera').css({
				'width':  W + 'px',
				'height': H + 'px'
			});
		}
	
		SelfCamera.prototype.bindVideoEvents = function () {
			$(this.video).on("stalled", function (e) {
				this.load();
			});
			$(this.video).on("playing", this.resizeVideo.bind(this));
			$(this.video).on('click', function () { this.play(); });
		};
	
		SelfCamera.prototype.bindEvents = function bindEvents() {
			var self = this;
	
			document.addEventListener('webkitvisibilitychange', function (event) {
				previewLock = false;
			});
	
			$('shutter').mousedown(function (ev) {
				$('shutter').addClass('active');
			}).mouseup(function (ev) {
				$('shutter').removeClass('active');
			}).on('touchstart', function (ev) {
				$('shutter').addClass('active');
			}).on('touchend', function (ev) {
				$('shutter').removeClass('active');
			});
	
			$(window).on('tizenhwkey', function (e) {
				if (e.originalEvent.keyName === "back") {
					if (self.countdownTimeoutID !== -1) {
					} else {
						tizen.application.getCurrentApplication().exit();
					}
				}
			});
		};
	
		SelfCamera.prototype.init = function init() {
			var self = this;
			self.startPreview();
			self.bindEvents();
		};
	
		}());
	
		selfCamera = new SelfCamera();
		document.onload = selfCamera.init();

</script>
<body>
   <div id="camera"></div>
</body>
</html>