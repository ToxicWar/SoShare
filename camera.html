<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>
</head>
<script src="js/libs/jquery.min.js"></script>
<script>
	var selfCamera;
	function SelfCamera() {};

	(function () {
		//var previewLock = false;
	
		SelfCamera.prototype = {
			countdownTimeoutID: -1,
			img: document.createElement('canvas'),
			//filename: '',
			video: null,
			src: null,
			isMediaWorking: false
		};
	
		SelfCamera.prototype.onCaptureVideoSuccess = function onCaptureVideoSuccess(stream) {
			var urlStream = window.webkitURL.createObjectURL(stream);
			this.isMediaWorking = true;
			this.createVideoElement(urlStream);
		};
	
		SelfCamera.prototype.createVideoElement = function (src) {
			var video = document.createElement('video');
			//video.id = 'video';
			video.autoplay = 'autoplay';
			video.style.height = window.innerHeight + 'px';
			video.src = src;
			camera.appendChild(video);
			this.video = video;
	
			this.bindVideoEvents();
		};
	
		SelfCamera.prototype.onCaptureVideoError = function onCaptureVideoError(e) {
			// alert("Video Capture Error");
			console.error(e);
		};
	
		SelfCamera.prototype.startPreview = function startPreview() {
			var options = {
				audio: true,
				video: true
			};
	
			navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia;
			try {
				if (typeof (navigator.getUserMedia) === 'function') {
					navigator.getUserMedia(options, this.onCaptureVideoSuccess.bind(this), this.onCaptureVideoError.bind(this));
				}
			} catch (e) {
				alert('navigator.getUserMedia() error.');
				console.error('navigator.getUserMedia() error: ' + e.message);
			}
	
		};
	
		SelfCamera.prototype.captureImage = function captureImage(video) {
			var sourceWidth = window.innerWidth,
				sourceHeight = window.innerHeight,
				sourceX = (sourceWidth - $(video).width()) / 2,
				sourceY = (sourceHeight - $(video).height()) / 2;
	
			this.img.width = sourceWidth;
			this.img.height = sourceHeight;
	
			// Crop image to viewport dimension
			this.img.getContext('2d').drawImage(video, sourceX, sourceY, $(video).width(), $(video).height());
	
			// To get best available dimension
			// this.img.width = video.videoWidth;
			// this.img.height = video.videoHeight;
			// this.img.getContext('2d').drawImage(video, 0, 0);
		};
	
		SelfCamera.prototype.resizeVideo = function() {
			var w = this.video.videoWidth,
				h = this.video.videoHeight,
				W = window.innerWidth,
				H = window.innerHeight,
				wide = w/h >= W/H,
				margin,
				size,
				vs = this.video.style;
			if (w <= 0 || h <= 0) {
				setTimeout(this.resizeVideo.bind(this), 100); // wait for stream
				return;
			}
			if (wide) {
				size = Math.round(w * H / h);
				margin = (W - size) / 2,
				vs.marginLeft = margin + 'px';
				vs.marginTop  = 0;
				vs.width  = size + 'px';
				vs.height =    H + 'px';
			} else {
				size = Math.round(h * W / w);
				margin = (H - size) / 2,
				vs.marginLeft = 0;
				vs.marginTop  = margin + 'px';
				vs.width  =    W + 'px';
				vs.height = size + 'px';
			}
			camera.style.width  = W + 'px';
			camera.style.height = H + 'px';
		}
	
		SelfCamera.prototype.bindVideoEvents = function () {
			this.video.onstalled = function(e){ this.load(); };
			this.video.onplaying = this.resizeVideo.bind(this);
			//this.video.onclick = function(){ this.play(); };
		};
	
		SelfCamera.prototype.bindEvents = function bindEvents() {
			var self = this;
	
			//document.addEventListener('webkitvisibilitychange', function (event) {
			//	previewLock = false;
			//});
	
			$('shutter').mousedown(function (ev) {
				$('shutter').addClass('active');
			}).mouseup(function (ev) {
				$('shutter').removeClass('active');
			}).on('touchstart', function (ev) {
				$('shutter').addClass('active');
			}).on('touchend', function (ev) {
				$('shutter').removeClass('active');
			});
	
			window.ontizenhwkey = function (e) {
				if (e.originalEvent.keyName === "back") {
					if (self.countdownTimeoutID !== -1) {
					} else {
						tizen.application.getCurrentApplication().exit();
					}
				}
			};
		};
	
		SelfCamera.prototype.init = function init() {
			var self = this;
			self.startPreview();
			self.bindEvents();
		};
	
		}());
	
		selfCamera = new SelfCamera();
		document.onload = selfCamera.init();

</script>
<body style="margin: 0; overflow: hidden;">
	<div id="camera"></div>
</body>
</html>
